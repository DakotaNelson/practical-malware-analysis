Lab 3-1
=======

1. The softare's strings, according to Process Explorer, are: 
  ```
  jjjjjj
  !This program cannot be run in DOS mode.
  Rich
  .text
  `.data
  ExitProcess
  kernel32.dll
  cks=u
  ttp=
  cks=
  CONNECT %s:%i HTTP/1.0
  QSRW
  PWW
  thj@h
  PWW
  VSWRQ
  QVlM
  ^-m-m<|<|<|M
  advapi32
  ntdll
  user32
  Jbh
  QQVP
  ucj
  advpack
  StubPath
  SOFTWARE\Classes\http\shell\open\commandV
  Software\Microsoft\Active Setup\Installed Components\
  test
  www.practicalmalwareanalysis.com
  admin
  VideoDriver
  WinVMX32-
  vmx32to64.exe
  SOFTWARE\Microsoft\Windows\CurrentVersion\Run
  SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
  PWj
  AppData
  VQj
  ViW
  ```
  Of particular interest are `www.practicalmalwareanalysis.com`, `CONNECT %s:%i HTTP/1.0`, and the various file path strings.

  The file has a number of interesting imports, including many related to threads, mutexes and semaphores, manipulating files, loading libraries, and creating and manipulating named pipes.

2. Host-based indicators include the strings seen above. Regshot shows no changed or added registry keys (beyond some noise), and [procmon](./procmon.txt) shows very little interesting activity - loading kernel32.dll, reading some registry keys (none of which seem unusual), then exiting. Curiously, the process exits with status `-1073741819`, which suggests to me that this malware is failing to execute properly.

3. ApateDNS seems only to turn up requests to `watson.microsoft.com` and `wpad.olin.edu`. Netcat shows the following, which seems consistent with Apate's findings:

  ```
  C:\Users\IEUser\Desktop\nc111nt>nc -l -p 80
  GET /wpad.dat HTTP/1.1
  Connection: Keep-Alive
  Accept: */*
  Host: 127.0.0.1
  ```

  ```
  C:\Users\IEUser\Desktop\nc111nt>nc -l -p 443
  ▬♥☺ ⌂☺  {♥☺X┤áP♠/i(ÄGh◄PkP2☼R(▓Ç-♀WNu▀#ö┘¡d  ∟└¶└‼ 9 3 5 /└
  └        8 2
  ‼ ♣ ♦☺  6   ↓ ↨  ¶watson.microsoft.com
  ♠ ♦ ↨ ↑ ♂ ☻☺  ↨   ☺ ☺
  ```

  Neither of these seem to be caused by the file being analyzed. In addition, Process Explorer shows no TCP/IP connections, nor does the file seem to import any networking libraries. This is odd, since a domain name and apparent HTML connection string appear in the file's strings.

Lab 3-2
=======

1. According to PE Explorer, `Lab03-02.dll` exports `Install`, `ServiceMain`, `UninstallService`, `installA`, and `uninstallA`. This implies that the malware could be installed as a service by running `rundll32.exe Lab03-02.dll,install MalService`.

Unfortunately, doing so (even without any arguments - `rundll32.exe Lab03-02.dll,install`) results in a crash:

  ```
  Version=1
  EventType=APPCRASH
  EventTime=131327951831980417
  ReportType=2
  Consent=1
  UploadTime=131327951832481137
  ReportIdentifier=cba757e2-fe06-11e6-8ca2-08002785c5cd
  IntegratorReportIdentifier=cba757e1-fe06-11e6-8ca2-08002785c5cd
  Response.type=4
  Sig[0].Name=Application Name
  Sig[0].Value=rundll32.exe
  Sig[1].Name=Application Version
  Sig[1].Value=6.1.7600.16385
  Sig[2].Name=Application Timestamp
  Sig[2].Value=4a5bc637
  Sig[3].Name=Fault Module Name
  Sig[3].Value=ntdll.dll
  Sig[4].Name=Fault Module Version
  Sig[4].Value=6.1.7601.23572
  Sig[5].Name=Fault Module Timestamp
  Sig[5].Value=57fd0335
  Sig[6].Name=Exception Code
  Sig[6].Value=c0000005
  Sig[7].Name=Exception Offset
  Sig[7].Value=00052a0e
  DynamicSig[1].Name=OS Version
  DynamicSig[1].Value=6.1.7601.2.1.0.256.4
  DynamicSig[2].Name=Locale ID
  DynamicSig[2].Value=1033
  DynamicSig[22].Name=Additional Information 1
  DynamicSig[22].Value=0a9e
  DynamicSig[23].Name=Additional Information 2
  DynamicSig[23].Value=0a9e372d3b4ad19135b953a78882e789
  DynamicSig[24].Name=Additional Information 3
  DynamicSig[24].Value=0a9e
  DynamicSig[25].Name=Additional Information 4
  DynamicSig[25].Value=0a9e372d3b4ad19135b953a78882e789
  UI[2]=C:\Windows\system32\rundll32.exe
  UI[3]=Windows host process (Rundll32) has stopped working
  UI[4]=Windows can check online for a solution to the problem.
  UI[5]=Check online for a solution and close the program
  UI[6]=Check online for a solution later and close the program
  UI[7]=Close the program
  LoadedModule[0]=C:\Windows\system32\rundll32.exe
  LoadedModule[1]=C:\Windows\SYSTEM32\ntdll.dll
  LoadedModule[2]=C:\Windows\system32\kernel32.dll
  LoadedModule[3]=C:\Windows\system32\KERNELBASE.dll
  LoadedModule[4]=C:\Windows\system32\USER32.dll
  LoadedModule[5]=C:\Windows\system32\GDI32.dll
  LoadedModule[6]=C:\Windows\system32\LPK.dll
  LoadedModule[7]=C:\Windows\system32\USP10.dll
  LoadedModule[8]=C:\Windows\system32\msvcrt.dll
  LoadedModule[9]=C:\Windows\system32\imagehlp.dll
  LoadedModule[10]=C:\Windows\system32\ADVAPI32.dll
  LoadedModule[11]=C:\Windows\SYSTEM32\sechost.dll
  LoadedModule[12]=C:\Windows\system32\RPCRT4.dll
  LoadedModule[13]=C:\Windows\system32\apphelp.dll
  LoadedModule[14]=C:\Windows\AppPatch\AcLayers.DLL
  LoadedModule[15]=C:\Windows\system32\SspiCli.dll
  LoadedModule[16]=C:\Windows\system32\SHELL32.dll
  LoadedModule[17]=C:\Windows\system32\SHLWAPI.dll
  LoadedModule[18]=C:\Windows\system32\ole32.dll
  LoadedModule[19]=C:\Windows\system32\OLEAUT32.dll
  LoadedModule[20]=C:\Windows\system32\USERENV.dll
  LoadedModule[21]=C:\Windows\system32\profapi.dll
  LoadedModule[22]=C:\Windows\system32\WINSPOOL.DRV
  LoadedModule[23]=C:\Windows\system32\MPR.dll
  LoadedModule[24]=C:\Windows\system32\IMM32.DLL
  LoadedModule[25]=C:\Windows\system32\MSCTF.dll
  LoadedModule[26]=C:\Users\IEUser\Desktop\Practical Malware Analysis Labs\BinaryCollection\Chapter_3L\Lab03-02.dll
  LoadedModule[27]=C:\Windows\system32\WS2_32.dll
  LoadedModule[28]=C:\Windows\system32\NSI.dll
  LoadedModule[29]=C:\Windows\system32\WININET.dll
  LoadedModule[30]=C:\Windows\system32\api-ms-win-downlevel-user32-l1-1-0.dll
  LoadedModule[31]=C:\Windows\system32\api-ms-win-downlevel-shlwapi-l1-1-0.dll
  LoadedModule[32]=C:\Windows\system32\api-ms-win-downlevel-version-l1-1-0.dll
  LoadedModule[33]=C:\Windows\system32\version.DLL
  LoadedModule[34]=C:\Windows\system32\api-ms-win-downlevel-normaliz-l1-1-0.dll
  LoadedModule[35]=C:\Windows\system32\normaliz.DLL
  LoadedModule[36]=C:\Windows\system32\iertutil.dll
  LoadedModule[37]=C:\Windows\system32\api-ms-win-downlevel-advapi32-l1-1-0.dll
  LoadedModule[38]=C:\Windows\system32\uxtheme.dll
  LoadedModule[39]=C:\Windows\system32\dwmapi.dll
  FriendlyEventName=Stopped working
  ConsentKey=APPCRASH
  AppName=Windows host process (Rundll32)
  AppPath=C:\Windows\system32\rundll32.exe
  ```

2. After installation, the above-named `MalService` could theoretically be run with `net start MalService`.

3. In Process Explorer, look for the DLL `Lab03-02.dll` to be loaded into a running process; it should be under a `svchost.exe` process.

4. During the installation process, setting procmon filters for `rundll32.exe` should provide some useful filtering, and afterward once the process is identified in process explorer, either a PID or process name could be used to isolate the service's actions.

5. There are a large number of unique strings which could be used for host-based detection, but the inability to install the DLL above impedes digging deeper into the malware's activity.

6. The malware contains some strings which suggest network activity: `practicalmalwareanalysis.com`, `HTTP/1.1`, etc., and also imports `WinInet.dll`, which strongly suggests that the malware has an internet component; unfortunately, due to being unable to install the service, I'm unable to explore further.

Lab 3-3
=======

1. It's odd that `Lab03-03.exe` spawns a process `svchost.exe`.

2. Yes; the `svchost.exe` process has significantly different strings on disc and in memory - and, in addition, has a number of strings in memory such as `[SHIFT]`, `[TAB]`, etc. that seem to indicate it is logging keystrokes. In addition, for some reason the `Lab03-03.exe` process has an `<error opening process>` message in the pane for strings in memory - this perhaps accompanies the popup when the program is executed that says "The application was unable to start correctly", so it may not be an odd indicator.

3. The string `practicalmalwareanalysis.log` present in memory for the `svchost.exe` process suggests to me this program creates a logfile somewhere. As noted in the previous question, the strings that suggest keylogging are also likely present somewhere on disk (presumably in this logfile).

4. I very strongly suspect that this is a keylogger.


Lab 3-4
=======

1. The executable file for the lab disappears; presumably deleted. In addition, Process Monitor reports that at one point a process was creted executing `cmd.exe`, which is consistent with my observation that a command window briefly appeared and then disappeared. Process Monitor reports that the event's command line value was `"C:\Windows\System32\cmd.exe" /c del C:\Users\IEUser\Desktop\PRACTI~1\BINARY~1\CHD8AF~1\Lab03-04.exe >> NUL`.

2. The incredible speed of the process made catching it in Process Explorer quite difficult. In addition, spawning a command line process causes us to be unable to introspect some of the executable's actions since they take place in a different process.

3. The program can be run from the command line, through `explorer.exe`, or through Process Explorer. It could also be executed with a debugger attached, though we haven't gotten there yet. :)
